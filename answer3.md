# ospabOS - Полное описание проекта

## Введение

**ospabOS** - это современная операционная система, разработанная на языке Rust для архитектуры x86_64. Проект представляет собой учебно-исследовательскую ОС с акцентом на безопасность, модульность и современные технологии. ОС построена на принципах микроядра с системой передачи сообщений IPC (Inter-Process Communication).

**Версия:** v0.1.5 "Foundation"  
**Дата:** Февраль 2026  
**Архитектура:** x86_64  
**Язык:** Rust (no_std)  
**Бootloader:** Limine  
**Лицензия:** MIT

## Архитектурные принципы

### Микроядерная архитектура
- **Модульность:** Каждый компонент системы - отдельный модуль с четкими интерфейсами
- **IPC:** Все взаимодействие между компонентами через асинхронную передачу сообщений
- **Минимализм ядра:** Только базовые функции в ядре, остальное - сервисы
- **Безопасность:** Изоляция компонентов, защита памяти через VMM

### Слои системы

```
┌─────────────────────────────────────┐
│         User Applications           │
├─────────────────────────────────────┤
│         User Shell (bash-like)      │
├─────────────────────────────────────┤
│         System Services             │
│  ├─ Terminal Service                │
│  ├─ VFS Service                     │
│  ├─ Auth Service                    │
│  └─ Network Service                 │
├─────────────────────────────────────┤
│         IPC Message Bus             │
├─────────────────────────────────────┤
│         Kernel Services             │
│  ├─ Syscall Interface               │
│  ├─ Virtual Memory Manager          │
│  ├─ Task Scheduler                  │
│  ├─ Process Manager                 │
│  ├─ Frame Allocator                 │
│  ├─ Timer (PIT)                     │
│  ├─ Interrupt Handling              │
│  ├─ GDT/TSS Management              │
│  ├─ Drivers Layer                   │
│  │  ├─ Framebuffer (UEFI)           │
│  │  ├─ Serial (COM1)                │
│  │  ├─ Keyboard (PS/2)              │
│  │  ├─ Timer (PIT)                  │
│  │  └─ Network (Future)             │
│  └─ Filesystem Layer                │
│     ├─ Initrd (TAR)                 │
│     └─ VFS Abstraction              │
├─────────────────────────────────────┤
│         Hardware Abstraction        │
│  ├─ x86_64 CPU Management           │
│  ├─ Memory Management (HHDM)        │
│  ├─ Interrupt Controller (PIC/APIC)│
│  └─ Boot Protocol (Limine)          │
└─────────────────────────────────────┘
```

## Kernel Space (Ядро)

### Базовая инфраструктура
- **GDT (Global Descriptor Table):** Сегментная защита памяти
- **IDT (Interrupt Descriptor Table):** Обработка прерываний
- **TSS (Task State Segment):** Переключение задач
- **PIC/APIC:** Управление прерываниями
- **SSE/SSE2:** Векторные инструкции для системных вызовов

### Управление памятью
- **Физическая память:** Frame allocator для страниц 4KB
- **Виртуальная память:** VMM с таблицами страниц x86_64
- **HHDM (Higher Half Direct Mapping):** Прямое отображение физической памяти
- **Куча:** Linked list allocator для динамической памяти

### Планировщик задач
- **Round-robin scheduling:** Чередование задач
- **Preemptive multitasking:** Вытесняющая многозадачность
- **TSS switching:** Переключение контекста через TSS
- **Timer-driven:** PIT для квантов времени

### Системные вызовы
- **Интерфейс syscall:** x86_64 fast syscall
- **Безопасность:** Проверка параметров, валидация указателей
- **Асинхронность:** Неблокирующие операции

### Драйверы устройств
- **Framebuffer:** UEFI GOP, поддержка RGB/BGR
- **Serial:** COM1 для отладки
- **Keyboard:** PS/2 с маппингом скан-кодов
- **Timer:** PIT 8253/8254 для системного времени

### Файловая система
- **VFS (Virtual File System):** Абстракция над ФС
- **Initrd:** TAR-based initial ramdisk
- **Планируемые ФС:** Ext2, FAT32

## System Services (Системные сервисы)

### IPC Message Bus
- **Асинхронная передача:** Сообщения между сервисами
- **Типизация:** Request/Response паттерн
- **Очереди:** Буферы сообщений

### Terminal Service
- **Ввод/вывод:** Обертка над драйверами
- **Буфер:** Кольцевой буфер для ввода
- **Кодировка:** UTF-8 поддержка

### VFS Service
- **Файловые операции:** open, read, write, close
- **Директории:** ls, cd, mkdir
- **Права доступа:** Базовая система прав

### Auth Service (Система аутентификации)
- **Пользователи:** UserManager с BTreeMap
- **Пароли:** Хэширование (SHA-256 планируется)
- **Права:** Read, Write, Execute, Admin
- **Сессии:** Текущий пользователь

### Network Service (Сетевой стек)
- **Ethernet:** MAC адреса, кадры
- **IP:** IPv4 адреса, маршрутизация
- **TCP/UDP:** Транспортные протоколы
- **Socket API:** BSD-compatible сокеты
- **DNS:** Разрешение имен

## User Space (Пользовательское пространство)

### User Shell
- **Команды:**
  - `help` - справка
  - `clear` - очистка экрана
  - `echo <text>` - вывод текста
  - `ls [path]` - список файлов
  - `cat <file>` - просмотр файла
  - `cd <dir>` - смена директории
  - `pwd` - текущая директория
  - `uptime` - время работы
  - `version` - версия ОС
  - `exec <cmd>` - выполнение команды
  - `shutdown` - выключение
  - `reboot` - перезагрузка
  - `doom` - запуск DOOM
  - `tomato` - тест IPC
  - `grape` - текстовый редактор
  - `history` - история команд

### Новые команды (v0.1.5)
- **Пользовательские:**
  - `login` - вход в систему
  - `logout` - выход
  - `useradd <user>` - добавление пользователя
  - `users` - список пользователей
  - `whoami` - текущий пользователь

- **Сетевые:**
  - `ping <host>` - пинг хоста
  - `ifconfig` - информация о сетевых интерфейсах

### Приложения
- **Grape:** Текстовый редактор с VFS интеграцией
- **Tomato:** Тест IPC между процессами
- **DOOM:** Полноценный порт DOOM с framebuffer

## Особенности и инновации

### Безопасность
- **Memory safety:** Rust предотвращает уязвимости
- **Изоляция:** Microkernel архитектура
- **Права доступа:** Система пользователей и прав
- **Валидация:** Проверка всех входных данных

### Производительность
- **Zero-copy:** Минимизация копирования данных
- **Lazy allocation:** Выделение памяти по требованию
- **Interrupt-driven:** Эффективная обработка событий

### Разработка
- **Модульность:** Легкое добавление новых компонентов
- **Отладка:** Детальные логи на serial порту
- **Тестирование:** Встроенные тесты компонентов

### Современные технологии
- **Async/await:** Планируется для сетевых операций
- **Traits:** Rust traits для интерфейсов
- **Smart pointers:** Безопасное управление памятью

## Сборка и запуск

### Требования
- **Rust:** nightly с target x86_64-unknown-none
- **QEMU:** Для эмуляции
- **OVMF:** UEFI firmware
- **Limine:** Bootloader

### Сборка
```bash
cd kernel
./build.sh          # Сборка ядра
./build_iso.sh      # Создание ISO
```

### Запуск
```bash
# QEMU с UEFI
qemu-system-x86_64 -machine q35 \
  -drive if=pflash,format=raw,unit=0,readonly=on,file=OVMF_CODE.fd \
  -drive if=pflash,format=raw,unit=1,file=OVMF_VARS.fd \
  -cdrom ospab-os.iso -m 256M -serial stdio
```

### Отладка
- **Serial output:** Все логи на COM1
- **GDB:** Поддержка отладки ядра
- **Logs:** Детальные сообщения инициализации

## Roadmap (Планы развития)

### v0.2.0 "Networking"
- Полная реализация TCP/IP стека
- Ethernet драйвер
- HTTP клиент/сервер

### v0.3.0 "Filesystem"
- Ext2/Ext4 поддержка
- FUSE-подобный интерфейс
- RAID и LVM

### v0.4.0 "Userspace"
- ELF loader
- Dynamic linking
- Systemd-подобный init

### v0.5.0 "GUI"
- Wayland композитор
- GTK/Qt bindings
- Графические приложения

## Заключение

ospabOS представляет собой современную, безопасную и модульную операционную систему, сочетающую проверенные концепции микроядер с современными технологиями Rust. Проект идеально подходит для изучения системного программирования, исследования архитектур ОС и создания надежного программного обеспечения.

Ключевые преимущества:
- **Безопасность:** Memory-safe по дизайну
- **Модульность:** Легкое расширение и модификация
- **Производительность:** Эффективное использование ресурсов
- **Обучаемость:** Четкая структура и документация

Проект активно развивается и открыт для вклада сообщества.</content>
<parameter name="filePath">d:\ospab-projects\ospab.os\answer3.md