# fix.md ‚Äî –ß—Ç–æ –¥–µ–ª–∞—Ç—å, —á—Ç–æ–±—ã —è–¥—Ä–æ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å –∏ –ø–æ—è–≤–∏–ª—Å—è –≤—ã–≤–æ–¥

–¶–µ–ª—å: –ø–æ—à–∞–≥–æ–≤–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å, –ø–æ—á–µ–º—É Limine –≤–∏–¥–∏—Ç ISO, –Ω–æ —è–¥—Ä–æ –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç (–Ω–µ—Ç –≤—ã–≤–æ–¥–∞ –Ω–∞ serial/VGA).

---

## üîç –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å—Ä–∞–∑—É)
1. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ ISO —Å–æ–¥–µ—Ä–∂–∏—Ç `kernel` –≤ –∫–æ—Ä–Ω–µ:

```bash
xorriso -indev kernel/ospab-os-fixed.iso -ls /
# –æ–∂–∏–¥–∞–µ—Ç—Å—è: 'kernel' –∏ 'limine.conf' –∏ 'limine-bios.sys' –≤ –∫–æ—Ä–Ω–µ
```

2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `limine.conf` –≤ –∫–æ—Ä–Ω–µ (`iso_root/limine.conf`):

- –í—Ä–µ–º–µ–Ω–Ω–æ–µ/–ø—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–µ: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Å—Ç—É—é –∑–∞–ø–∏—Å—å

```text
/ospabOS
    path: boot():/kernel
    protocol: limine
```

(–ï—Å–ª–∏ —Å–µ–π—á–∞—Å `boot:///kernel.elf` ‚Äî –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–º–µ–Ω—è—Ç—å –Ω–∞ `kernel.elf` –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Å–±–æ—Ä–∫—É/—É—Å—Ç–∞–Ω–æ–≤–∫—É Limine ‚Äî –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å—Ä–µ–¥—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º –ø—É—Ç—ë–º.)

3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `limine-bios.sys` –ª–µ–∂–∏—Ç –≤ –æ–¥–Ω–æ–º –∏–∑ –æ–∂–∏–¥–∞–µ–º—ã—Ö –º–µ—Å—Ç (–∫–æ—Ä–µ–Ω—å, `/boot/`, `/limine/` –∏–ª–∏ `/boot/limine/`). –ï—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç ‚Äî —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤ `iso_root/` –∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ ISO.

```bash
# –∏–∑ –∫–æ—Ä–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
cp kernel/tools/limine/bin/limine-bios.sys kernel/iso_root/
```

4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ Limine —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ ISO (–∑–∞–ø—É—Å—Ç–∏—Ç–µ `bios-install`):

```bash
# –Ω–∞ Linux/WSL
kernel/tools/limine/bin/limine bios-install /tmp/ospab-os.iso
# –∏–ª–∏, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ prebuilt limine:
/path/to/limine-install /path/to/ospab-os.iso
```

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ `bios-install` —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π ISO –∏ –∫–æ–ø–∏—Ä—É–π—Ç–µ (–∏–ª–∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ) –µ–≥–æ –≤ `kernel/`.

---

## üßæ –ü—Ä–æ–≤–µ—Ä–∫–∞ ELF (–≤–∞–∂–Ω–æ –¥–ª—è Limine)
1. –ò–∑–≤–ª–µ—á—å `kernel.elf` –∏–∑ ISO –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–∫—Ü–∏–∏:

```bash
mkdir -p /tmp/iso_extract
xorriso -indev /mnt/d/ospab-projects/ospab.os/kernel/ospab-os-fixed.iso -osirrox on -extract /kernel.elf /tmp/iso_extract/kernel.elf
readelf -S /tmp/iso_extract/kernel.elf | grep limine
# –æ–∂–∏–¥–∞–µ—Ç—Å—è —Å–µ–∫—Ü–∏—è .limine_header
readelf -h /tmp/iso_extract/kernel.elf
readelf -l /tmp/iso_extract/kernel.elf
file /tmp/iso_extract/kernel.elf
```

2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å—Ç—Ä–æ–∫–∞ —Å –∫–æ—Ä–æ—Ç–∫–∏–º —Ç–µ—Å—Ç–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –±–∏–Ω–∞—Ä–Ω–∏–∫–µ (–º—ã –∑–∞–ø–∏—Å—ã–≤–∞–µ–º `ospabOS: booted\n` –≤ `_start`):

```bash
strings /tmp/iso_extract/kernel | grep -F 'ospabOS: booted' || true
```

–ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ —è–¥—Ä–æ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ —à–∞–≥–∏ –≤—ã—à–µ.

---

## üîå Serial / VGA: –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–≤–æ–¥–∞
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ QEMU —Å –ø—Ä—è–º–æ–π –∑–∞–ø–∏—Å—å—é –≤ —Ñ–∞–π–ª –∏ –∞–±—Å–æ–ª—é—Ç–Ω—ã–º –ø—É—Ç—ë–º (–Ω–∞ Windows –≤–∞–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–π –ø—É—Ç—å):

Windows PowerShell (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
```powershell
& 'D:\Toolz\qemu\qemu-system-x86_64.exe' -cdrom 'D:\ospab-projects\ospab.os\kernel\ospab-os-fixed.iso' -m 1024 -display none -serial file:D:\ospab-projects\ospab.os\kernel\serial.log -boot order=d
Get-Content .\serial.log -Wait
```

WSL (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å -serial stdio):
```bash
qemu-system-x86_64 -cdrom /mnt/d/ospab-projects/ospab.os/kernel/ospab-os-fixed.iso -m 1024 -nographic -serial stdio
```

2. –ï—Å–ª–∏ `serial.log` –æ—Å—Ç–∞—ë—Ç—Å—è –ø—É—Å—Ç—ã–º ‚Äî —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `_start` —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ COM1 (0x3F8):

```rust
static MSG: &[u8] = b"ospabOS: booted\n";
unsafe {
    use x86_64::instructions::port::Port;
    let mut port = Port::<u8>::new(0x3F8);
    for &b in MSG.iter() { port.write(b); }
}
```

3. –ï—Å–ª–∏ –∏ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω–µ—Ç –≤—ã–≤–æ–¥–∞ ‚Äî –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–≤–µ—Å—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ VGA –≤ –Ω–∞—á–∞–ª–µ `_start()` (–≤ `vga_buffer::init()` –∏ `print!`) ‚Äî –µ—Å–ª–∏ —ç–∫—Ä–∞–Ω –æ—á–∏—â–∞–µ—Ç—Å—è –∏ –≤–∏–¥–µ–Ω, –∑–Ω–∞—á–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å –¥–æ—à—ë–ª –¥–æ _start, –Ω–æ serial –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

## üß™ –ï—Å–ª–∏ Limine –≥–æ–≤–æ—Ä–∏—Ç "Failed to open executable"
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—Ä–∏–∞—Ü–∏–∏ `path:` –≤ `limine.conf`: –ø–æ–ø—Ä–æ–±—É–π—Ç–µ *–ø–æ –æ—á–µ—Ä–µ–¥–∏*:

- `path: boot():/kernel`
- `path: /kernel`

2. –ü–æ–ª–æ–∂–∏—Ç–µ `kernel` –Ω–µ —Ç–æ–ª—å–∫–æ –≤ –∫–æ—Ä–µ–Ω—å, –Ω–æ –∏ –≤ `/boot/`, `/limine/`, `/boot/limine/` –≤–Ω—É—Ç—Ä–∏ `iso_root/` (Limine –∏—â–µ—Ç –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö):

```bash
cp kernel/iso_root/kernel kernel/iso_root/boot/kernel
cp kernel/iso_root/kernel kernel/iso_root/limine/kernel
```

3. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ ISO, —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `limine bios-install` –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ—Å—å.

---

## üêû –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –æ—Ç–ª–∞–¥–∫–∞ (–µ—Å–ª–∏ –≤—Å—ë –µ—â—ë –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç)
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ QEMU –≤ —Ä–µ–∂–∏–º–µ `-S -gdb tcp::1234,server,nowait` –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å gdb (—É–¥–æ–±–Ω–æ —Å—Ç–∞–≤–∏—Ç—å –±—Ä–µ–π–∫–ø–æ–π–Ω—Ç—ã –≤ `_start`).

```bash
qemu-system-x86_64 -cdrom ospab-os-fixed.iso -m 1024 -S -gdb tcp::1234 -serial null
# –≤ –¥—Ä—É–≥–æ–π —Ç–µ—Ä–º–∏–Ω–∞–ª–µ: gdb /path/to/kernel.elf
# target remote :1234
```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ QEMU —Å `-d int,cpu_reset` –∏ `-D qemu.log` —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ QEMU.

3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ Limine –º–µ–Ω—é –∏ —Å–æ–æ–±—â–µ–Ω–∏—è: –µ—Å–ª–∏ Limine –∑–∞–≥—Ä—É–∑–∏–ª ELF –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –Ω–æ –∑–∞—Ç–µ–º –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–∞–¥–∞–µ—Ç ‚Äî –∑–Ω–∞—á–∏—Ç –ø—Ä–∏—á–∏–Ω—É –Ω–∞–¥–æ –∏—Å–∫–∞—Ç—å –≤ GDT/IDT/stack setup (double fault). –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ:

- GDT –∏ TSS –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- IDT —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (–Ω–∞ –≤—Ä–µ–º—è –æ—Ç–ª–∞–¥–∫–∏ ‚Äî –¥–µ–ª–∞–π—Ç–µ –∏—Ö `hlt`+print, –Ω–µ `panic!()`)
- –í—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ IST –¥–ª—è double-fault

---

## ‚úÖ –ë—ã—Å—Ç—Ä—ã–π —á–µ–∫-–ª–∏—Å—Ç: —á—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å
- [ ] `kernel.elf` –≤ –∫–æ—Ä–Ω–µ ISO –∏ –≤ `/boot`/`/limine` (–Ω–∞ –≤—Å—è–∫–∏–π)
- [ ] `limine.conf` —Å `path: kernel.elf` (–ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã)
- [ ] `limine-bios.sys` –≤ –∫–æ—Ä–Ω–µ ISO
- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω `limine bios-install` –Ω–∞ –∏—Ç–æ–≥–æ–≤–æ–º ISO
- [ ] QEMU –∑–∞–ø—É—â–µ–Ω —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º `-serial` (–∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –≤ Windows)
- [ ] –í –±–∏–Ω–∞—Ä–Ω–∏–∫–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π —Å—Ç—Ä–æ–∫–æ–≤—ã–π –≤—ã–≤–æ–¥ (`ospabOS: booted`)

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî —è –º–æ–≥—É —Å–¥–µ–ª–∞—Ç—å —ç—Ç–∏ —à–∞–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `iso_root/limine.conf` –Ω–∞ `path: kernel.elf`, –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å ISO –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Limine;
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å QEMU —Å –ø–æ–¥—Ö–æ–¥—è—â–∏–º `-serial` –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º –∏ –ø–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏/—Å–∫—Ä–∏–Ω—à–æ—Ç—ã;
- –ò–ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ GDB –∏ –ø–æ—à–∞–≥–æ–≤–æ –ø—Ä–æ—Å–ª–µ–¥–∏—Ç—å, –≥–¥–µ _start –ª–æ–º–∞–µ—Ç—Å—è.

–°–∫–∞–∂–∏, –∫–∞–∫–æ–π —É—Ä–æ–≤–µ–Ω—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ç—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—à—å ‚Äî ¬´—Å–¥–µ–ª–∞–π –≤—Å—ë —Å–∞–º¬ª –∏–ª–∏ ¬´–¥–∞–π –º–Ω–µ –∫–æ–º–∞–Ω–¥—ã, –∞ —è –±—É–¥—É –¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é¬ª. üëç
